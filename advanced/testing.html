<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Testing Caveats | VeeValidate</title>
    <meta name="description" content="Input validation for Vue.js">
    <meta charset="utf-8">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/img/ms-icon-144x144.png">
  <meta name="theme-color" content="#41b883">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="https://s3.eu-central-1.amazonaws.com/logaretm/vee-validate.svg">
  <link rel="apple-touch-icon" sizes="57x57" href="/vee-validate/img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/vee-validate/img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/vee-validate/img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/vee-validate/img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/vee-validate/img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/vee-validate/img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/vee-validate/img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/vee-validate/img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/vee-validate/img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/vee-validate/img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/vee-validate/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/vee-validate/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/vee-validate/img/favicon-16x16.png">
    
    <link rel="preload" href="/vee-validate/assets/css/0.styles.b135fead.css" as="style"><link rel="preload" href="/vee-validate/assets/js/app.50eb3ad5.js" as="script"><link rel="preload" href="/vee-validate/assets/js/3.46ca09f5.js" as="script"><link rel="preload" href="/vee-validate/assets/js/60.fd960778.js" as="script"><link rel="preload" href="/vee-validate/assets/js/12.49ded667.js" as="script"><link rel="preload" href="/vee-validate/assets/js/59.82df06bf.js" as="script"><link rel="prefetch" href="/vee-validate/assets/js/2.4754bc93.js"><link rel="prefetch" href="/vee-validate/assets/js/4.d64f224f.js"><link rel="prefetch" href="/vee-validate/assets/js/5.6bc6e656.js"><link rel="prefetch" href="/vee-validate/assets/js/6.e4baca63.js"><link rel="prefetch" href="/vee-validate/assets/js/7.511754b6.js"><link rel="prefetch" href="/vee-validate/assets/js/8.3fda4834.js"><link rel="prefetch" href="/vee-validate/assets/js/9.09e508d5.js"><link rel="prefetch" href="/vee-validate/assets/js/10.554097b8.js"><link rel="prefetch" href="/vee-validate/assets/js/11.346f0295.js"><link rel="prefetch" href="/vee-validate/assets/js/13.fed8c726.js"><link rel="prefetch" href="/vee-validate/assets/js/14.f75278eb.js"><link rel="prefetch" href="/vee-validate/assets/js/15.a44171a2.js"><link rel="prefetch" href="/vee-validate/assets/js/16.60b94c80.js"><link rel="prefetch" href="/vee-validate/assets/js/17.26fab5fe.js"><link rel="prefetch" href="/vee-validate/assets/js/18.ba629c7f.js"><link rel="prefetch" href="/vee-validate/assets/js/19.a69f64ea.js"><link rel="prefetch" href="/vee-validate/assets/js/20.34adc7a2.js"><link rel="prefetch" href="/vee-validate/assets/js/21.b906c454.js"><link rel="prefetch" href="/vee-validate/assets/js/22.8cd3b21f.js"><link rel="prefetch" href="/vee-validate/assets/js/23.c029c5dc.js"><link rel="prefetch" href="/vee-validate/assets/js/24.6fa5d0b6.js"><link rel="prefetch" href="/vee-validate/assets/js/25.2519a98d.js"><link rel="prefetch" href="/vee-validate/assets/js/26.81b6337b.js"><link rel="prefetch" href="/vee-validate/assets/js/27.05b9df79.js"><link rel="prefetch" href="/vee-validate/assets/js/28.69af6609.js"><link rel="prefetch" href="/vee-validate/assets/js/29.bc22cf0b.js"><link rel="prefetch" href="/vee-validate/assets/js/30.83dc7a3f.js"><link rel="prefetch" href="/vee-validate/assets/js/31.6f425c48.js"><link rel="prefetch" href="/vee-validate/assets/js/32.2dce5075.js"><link rel="prefetch" href="/vee-validate/assets/js/33.9cd42182.js"><link rel="prefetch" href="/vee-validate/assets/js/34.fd8ef583.js"><link rel="prefetch" href="/vee-validate/assets/js/35.47f9677a.js"><link rel="prefetch" href="/vee-validate/assets/js/36.22fc4ce1.js"><link rel="prefetch" href="/vee-validate/assets/js/37.74fc7a23.js"><link rel="prefetch" href="/vee-validate/assets/js/38.02d1f7bd.js"><link rel="prefetch" href="/vee-validate/assets/js/39.e1542b16.js"><link rel="prefetch" href="/vee-validate/assets/js/40.7935f6c0.js"><link rel="prefetch" href="/vee-validate/assets/js/41.8abe976a.js"><link rel="prefetch" href="/vee-validate/assets/js/42.a0edf8da.js"><link rel="prefetch" href="/vee-validate/assets/js/43.3c0cc536.js"><link rel="prefetch" href="/vee-validate/assets/js/44.25c2d854.js"><link rel="prefetch" href="/vee-validate/assets/js/45.9fcf9462.js"><link rel="prefetch" href="/vee-validate/assets/js/46.f974cb05.js"><link rel="prefetch" href="/vee-validate/assets/js/47.69307d4d.js"><link rel="prefetch" href="/vee-validate/assets/js/48.3d3ce2e8.js"><link rel="prefetch" href="/vee-validate/assets/js/49.f84d369f.js"><link rel="prefetch" href="/vee-validate/assets/js/50.47434342.js"><link rel="prefetch" href="/vee-validate/assets/js/51.4e76f829.js"><link rel="prefetch" href="/vee-validate/assets/js/52.147313f2.js"><link rel="prefetch" href="/vee-validate/assets/js/53.d780ac7e.js"><link rel="prefetch" href="/vee-validate/assets/js/54.c18c812d.js"><link rel="prefetch" href="/vee-validate/assets/js/55.c37df38b.js"><link rel="prefetch" href="/vee-validate/assets/js/56.bd8b6b0c.js"><link rel="prefetch" href="/vee-validate/assets/js/57.28155150.js"><link rel="prefetch" href="/vee-validate/assets/js/58.1180a708.js"><link rel="prefetch" href="/vee-validate/assets/js/vendors~docsearch.67757c28.js">
    <link rel="stylesheet" href="/vee-validate/assets/css/0.styles.b135fead.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vee-validate/" class="home-link router-link-active"><!----> <span class="site-name">VeeValidate</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vee-validate/guide/basics.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/vee-validate/configuration.html" class="nav-link">Config</a></div> <a href="https://github.com/logaretm/vee-validate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vee-validate/guide/basics.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/vee-validate/configuration.html" class="nav-link">Config</a></div> <a href="https://github.com/logaretm/vee-validate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vee-validate/overview.html" class="sidebar-link">Overview</a></li><li><a href="/vee-validate/migration.html" class="sidebar-link">Migration Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vee-validate/guide/basics.html" class="sidebar-link">Basics</a></li><li><a href="/vee-validate/guide/required-fields.html" class="sidebar-link">Required Fields</a></li><li><a href="/vee-validate/guide/rules.html" class="sidebar-link">Available Rules</a></li><li><a href="/vee-validate/guide/state.html" class="sidebar-link">Validation State</a></li><li><a href="/vee-validate/guide/forms.html" class="sidebar-link">Handling Forms</a></li><li><a href="/vee-validate/guide/localization.html" class="sidebar-link">Localization</a></li><li><a href="/vee-validate/guide/interaction-and-ux.html" class="sidebar-link">Interaction and UX</a></li><li><a href="/vee-validate/guide/3rd-party-libraries.html" class="sidebar-link">Validating 3rd Party Libraries</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Advanced</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vee-validate/advanced/rules-object-expression.html" class="sidebar-link">Rules Object Expression</a></li><li><a href="/vee-validate/advanced/cross-field-validation.html" class="sidebar-link">Cross Field Validation</a></li><li><a href="/vee-validate/advanced/dynamic-rules.html" class="sidebar-link">Dynamic Rules</a></li><li><a href="/vee-validate/advanced/refactoring-forms.html" class="sidebar-link">Refactoring Forms</a></li><li><a href="/vee-validate/advanced/server-side-validation.html" class="sidebar-link">Server Side Validation</a></li><li><a href="/vee-validate/advanced/programmatic-validation.html" class="sidebar-link">Core Validation API</a></li><li><a href="/vee-validate/advanced/testing.html" class="active sidebar-link">Testing Caveats</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vee-validate/advanced/testing.html#asynchronous-testing" class="sidebar-link">Asynchronous Testing</a></li><li class="sidebar-sub-header"><a href="/vee-validate/advanced/testing.html#don-t-test-implementation" class="sidebar-link">Don't test implementation</a></li><li class="sidebar-sub-header"><a href="/vee-validate/advanced/testing.html#testing-error-messages" class="sidebar-link">Testing Error Messages</a></li><li class="sidebar-sub-header"><a href="/vee-validate/advanced/testing.html#testing-validationobserver-debounced-state" class="sidebar-link">Testing ValidationObserver Debounced State</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vee-validate/api/validation-provider.html" class="sidebar-link">&lt;ValidationProvider /&gt;</a></li><li><a href="/vee-validate/api/validation-observer.html" class="sidebar-link">&lt;ValidationObserver /&gt;</a></li><li><a href="/vee-validate/api/with-validation.html" class="sidebar-link">withValidation()</a></li><li><a href="/vee-validate/api/validate.html" class="sidebar-link">validate()</a></li><li><a href="/vee-validate/api/extend.html" class="sidebar-link">extend()</a></li></ul></section></li></ul> </aside> <!----> <div id="ad"></div> <main class="page"> <div class="theme-default-content content__default"><h1 id="testing-caveats"><a href="#testing-caveats" aria-hidden="true" class="header-anchor">#</a> Testing Caveats</h1> <p>Testing is extremely important to give you confidence in your code. VeeValidate isn't special when it comes to testing, but a lot of issues seemed to miss a few important details about testing.</p> <p>This guide illustrates the caveats that you might encounter with vee-validate.</p> <p>TIP</p> <p>The following examples will use vue-test-utils API to conduct the tests.</p> <h2 id="asynchronous-testing"><a href="#asynchronous-testing" aria-hidden="true" class="header-anchor">#</a> Asynchronous Testing</h2> <p>VeeValidate is primarily asynchronous, so you would need to disable vue-test-utils sync mode. And you will use flush-promises to wait for the updated to take effect.</p> <p>To disable the sync mode, when mounting the component set the sync option to false in the mounting options.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> sync<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After triggering an event like an input event, make sure to call flushPromises before checking the UI for changes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="don-t-test-implementation"><a href="#don-t-test-implementation" aria-hidden="true" class="header-anchor">#</a> Don't test implementation</h2> <p>Generally you want to test how your UI behaves rather than how it does it.</p> <p>“I don’t care how you come up with the answer, just make sure that the answer is correct under this set of circumstances”</p> <p>Consider this test for example, we have this component:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ValidationProvider</span> <span class="token attr-name">rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>required<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ errors }<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>provider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ errors[0] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ValidationProvider</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>A test case could look like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> sync<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// flush the pending validation.</span>
<span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Get the error message from the ref</span>
<span class="token keyword">const</span> error <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>While this test would work fine, it could fail easily, since <code>messages</code> is internal property and may change at anytime without notice and also if you decided to swap vee-validate for something else it will immediately break, you want to test your UI the way the user would use it.</p> <p>So instead of checking the internal messages, let's describe what the user will actually experience via a short story and simulate that.</p> <p>&quot;The user should see an error when they input an empty value&quot;</p> <p>You could test that like this,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> sync<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// flush the pending validation.</span>
<span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check if the element has text inside it.</span>
<span class="token keyword">const</span> errorEl <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This test is much more robust than the previous one, if you were to change the validation your tests would still work. Because we are not testing implementation details, we care if the validation is done, we don't care how it is being done.</p> <h2 id="testing-error-messages"><a href="#testing-error-messages" aria-hidden="true" class="header-anchor">#</a> Testing Error Messages</h2> <p>Following upon the previous idea, testing specific error messages is also very flaky. Assume you have a language for which your messages may change at any time, for example they are generated by a backend service, or they can be improved as you iterate through your app. You want to keep improving those messages grammar-wise or style wise.</p> <p>For example, you could have this in your tests:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'The name field is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The problem with this, is that you may change the style to This field is required. Or even change the field name for something less ambiguous like full name. Ask your self this: do you really care if that specific message is displayed? or are you are only interested in having a message appear to your user?</p> <p>Depending on your answer, you might change how the test is conducted.</p> <p>If you want to check if any message is going to be displayed, any of these would do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Any message</span>
<span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// we only care if the message has `required`.</span>
<span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="testing-validationobserver-debounced-state"><a href="#testing-validationobserver-debounced-state" aria-hidden="true" class="header-anchor">#</a> Testing ValidationObserver Debounced State</h2> <p>The <code>ValidationObserver</code> state is computed every 16ms. So if you have a template like this:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ValidationObserver</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>observer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ dirty }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ValidationProvider</span>
    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>provider<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ValidationProvider</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
    <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>!dirty<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">data-test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    My button
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ValidationObserver</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>And you want to test if the button is actually disabled, you could try to do the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span><span class="token function">attributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>disabled<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which fails due to the <code>ValidationObserver</code> not having the state updated yet, you would need to wait for <code>16+</code> ms for your test to work.</p> <p>To work around this, you should make use of <a href="https://jestjs.io/docs/en/timer-mocks" target="_blank" rel="noopener noreferrer"><code>jest.useFakeTimers()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or any timer mocking functions that can be used to mock passed time.</p> <p>First you need to inject the mocked timers:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// before running tests</span>
jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And before anytime you test something that involves the <code>ValidationObserver</code> state, you use:</p> <div class="language-js extra-class"><pre class="language-js"><code>jest<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>
jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also write your own <code>flush</code> method that should make waiting for async operations much easier:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jest<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/logaretm/vee-validate/edit/master/docs/advanced/testing.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vee-validate/advanced/programmatic-validation.html" class="prev">Core Validation API</a></span> <span class="next"><a href="/vee-validate/api/validation-provider.html">&lt;ValidationProvider /&gt;</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vee-validate/assets/js/app.50eb3ad5.js" defer></script><script src="/vee-validate/assets/js/3.46ca09f5.js" defer></script><script src="/vee-validate/assets/js/60.fd960778.js" defer></script><script src="/vee-validate/assets/js/12.49ded667.js" defer></script><script src="/vee-validate/assets/js/59.82df06bf.js" defer></script>
  </body>
</html>
